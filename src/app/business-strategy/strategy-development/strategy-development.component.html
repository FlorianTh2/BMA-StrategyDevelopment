<div>
  <mat-drawer-container class="example-container" autosize hasBackdrop="false">
    <mat-drawer #drawer class="example-sidenav" mode="push" position="end">

        <h4>Speichern Sie ihr Reifegradmodell - Ergebnis</h4>

        <form class="ui form" [formGroup]="saveConsistencyMatrixForm" (ngSubmit)="saveConsistencyMatrix()">
          <h5>
            Wählen Sie einen Namen für die Konsistenzmatrix
          </h5>
            <mat-form-field class="example-form-field">
              <mat-label>Name</mat-label>
              <input matInput type="text" formControlName="consistencyMatrixNameView">
            </mat-form-field>
          <br>
          <h5>
            Hinterlegen Sie eine Beschreibung für die Konsistenzmatrix
          </h5>
          <mat-form-field class="example-form-field">
            <mat-label>Kurzbeschreibung</mat-label>
            <input matInput type="text" formControlName="consistencyMatrixDescription">
          </mat-form-field>
          <br>
          <h5>
            Wählen Sie ein Projekt, indem die Konsistenzmatrix gespeichert werden soll.
          </h5>
          <mat-form-field appearance="fill">
            <mat-label>Projekt wählen</mat-label>
            <mat-select formControlName="projectsView" multiple>
              <mat-option *ngFor="let project of userProjects" [value]="project">{{project.name}}</mat-option>
            </mat-select>
          </mat-form-field>
          <br>
          <button mat-raised-button class="ui button save-maturity-model-button0" type="submit">Save</button>
        </form>
    </mat-drawer>

<div class="" style="padding: 100px">
  <div>
    <h1>
      Geschäftsstrategie - Self Service
    </h1>
    <h3>
      Erstellen Sie ihre individuelle Geschäftsstrategie
    </h3>
  </div>
  <div>

  <div style="display: flex; justify-content: space-between">
    <div>
      <h5>
        Konsistenzmatrix hochladen
      </h5>
      <button mat-raised-button color="" (click)="fileInput.click()">Konsistenzmatrix hochladen</button>
      <input hidden type="file" (change)="uploadConsistencyMatrix($event)" #fileInput id="file">

      <div style="height: 25px"></div>

      <ng-container *ngIf="consistencyMatrix">
        <div>
          <ng-container *ngIf="consistencyMatrixStored">
            Ihre Konsistenzmatrix wurde erfolgreich aus dem Backendspeicher geladen. Sie hat folgende Parameter:
          </ng-container>
          <ng-container *ngIf="!consistencyMatrixStored">
            Ihre Konsistenzmatrix wurde erfolgreich hochgeladen. Sie hat folgende Parameter:
          </ng-container>

          <div style="height: 25px"></div>
          <div>
            Anzahl Variablen: [{{getNumberOfVariablesConsistencyMatrix()}}]
          </div>
          <div style="height: 10px"></div>
          <div>
            Anzahl Optionen: [{{getNumberOfOptionsConsistencyMatrix()}}]
          </div>
        </div>
      </ng-container>
    </div>
    <!-- -->
    <div>
      <div *ngIf="user && this.consistencyMatrix">
        <div *ngIf="!consistencyMatrix_id">
          <button mat-raised-button color="" class="save-maturity-model-button" (click)="saveConsistencyMatrixToggle()">Speichern Sie die hochgeladene Konsistenzmatrix</button>
        </div>
      </div>
      <div *ngIf="!user">
        <button mat-raised-button color="" [disabled]="true" class="save-maturity-model-button">Einloggen zum Speichern!</button>
      </div>
    </div>
  </div>

    <div style="height: 100px"></div>

    <h5>
      Erstellung Strategiebündel
    </h5>
    Allgemeine Information
    <br>
    Die Bündelerstellung erstellt für jede mögliche Optionskombination ein mögliches Bündel. Dabei existieren dabei m^n verschiedene Bündel, wobei m = Anzahl der Operationen, n = Anzahl der Variablen ist.
    Jedes einzelne Bündel hat dabei (n/2) * (n-1) verschiedene Optionen, wobei n = Anzahl der Variablen.
    Beispiel: 10 Variablen mit je 5 Optionen: 5^10 = ~9.77 Millionen Bündel, wobei jedes einzelne Bündel 45 Optionskombinationen enthällt. Dies ergibt somit ca. 45 Millionen Rechenoperationen.
    Die Anzahl der Bündel steigt dabei exponentiell. Die Berechnung praktische Berechnung findet im Frontend statt.
    Eine Richtlinie ist dabei folgende: 45 Mio. Rechenoperationen = ca. 30s.

    Es werden somit optionale Limitierungen eingeführt.
    <div>
    Bitte geben Sie ein Limit für die zu betrachteten Bündel an:
    Empfohlen ist ein Limit auf ca. 500.000 Iterationen um eine verzögerungsfreie Betrachtung zu gewährleisten.
      <br>
      Bitte geben Sie ebenfalls ein Limit für die Anzahl der zu speichernden (konsistentesten) Bündel an.
      Dies ist notwendig da die Anzahl der Bündel und der Optionskombinationen pro Bündel speicherintensiv ist und der Browser ein Limit von ca. 2GB hat.
      Beispiel: 10 Variablen je 5 Optionen = 45 Mio. Speichereinheiten. 45 Mio * 4 Byte = ca. 180 MB Rohspeicherplatz.
      Empfohlen ist ein Limit auf ca. 4.000 Bündel um eine verzögerungsfreie Betrachtung zu gewährleisten.
      <br>
      Bitte geben Sie dazu noch eine Konsistenzgrenze an. Die beschreibt ab welchem Konsistenzwert einer Optionskombination das Bündel als konsistent angesehen wird.
      Beispiel: Konsistenzgrenze=1 (empfohlen). Das heißt ab einem Konsistenzwert von größer 1 wird die Optionskombination eines Bündels als konsistent betrachtet.
      <br>
      Bitte geben Sie zusätzlich noch eine Strategie zum Umgang mit gleichem Konsistentwert an: Sollen bei vollem Bündelspeicher und gleichem Konsistenzwert eines Bündels ("neues Bündel")
      mit einem Bündel im Bündelspeicher mit dem minimalsten Konsistenzwert ("altes Bündel") das neue Bündel aufgenommen und das alte Bündel gelöscht werden (default) oder das alte Bündel behalten werden?
    <div style="height: 25px"></div>
    <ng-container *ngIf="consistencyMatrix">
      Für die aktuelle Konsistenzmatrix sind maximal: [{{getMaxIterations()}}] Bündel / Iterationen zu durchlaufen.
      Die Gleiche Anzahl an Bündeln ist maximal speicherbar.
    </ng-container>
    </div>
    <div style="height: 25px"></div>
    <div>
      Bitte geben Sie ein Limit für die zu betrachteten / durchlaufenden Bündel an:
      <br>
      <mat-form-field class="example-full-width" appearance="fill">
        <mat-label>Maximale Iterationen</mat-label>
      <input matInput type="number" value="{{maxIterations}}" (input)="setMaxIterations($event)"  />
      </mat-form-field>
    </div>
    <div style="height: 20px"></div>
    <div>
      Bitte geben Sie ein Limit für die zu speichernden Bündel an:
      <br>
      <mat-form-field class="example-full-width" appearance="fill">
        <mat-label>Größe Bündelspeicher</mat-label>
      <input matInput type="number" value="{{maxStoredBundles}}" (input)="setMaxStoredBundles($event)"  />
      </mat-form-field>
    </div>

    <div>
      Bitte geben Sie eine Konsistenzgrenze an:
      <br>
      <mat-form-field class="example-full-width" appearance="fill">
        <mat-label>Konsistenzgrenze</mat-label>
        <input matInput type="number" value="{{consistencyBoundary}}" (input)="setConsistencyBoundary($event)"  />
      </mat-form-field>
    </div>
    <div>
      Bitte geben Sie eine Strategie im Umgang mit Bündel mit gleichem Konsistentwert an:
      <br>
      <section class="example-section">
        <label class="example-margin">Konsistenzstrategie</label>
        <mat-radio-group [(ngModel)]="setNewBundleLabelPosition">
          <mat-radio-button class="example-margin" [value]="true">Setze neues Bündel</mat-radio-button>
          <mat-radio-button class="example-margin" [value]="false">Behalte altes Bündel</mat-radio-button>
        </mat-radio-group>
      </section>
    </div>

    <div style="height: 20px"></div>

    <button mat-raised-button color="" (click)="createBundles($event)">Erstelle konsistente Strategiebündel</button>

    <div style="height: 50px"></div>

    <ng-container *ngIf="bundleMatrix">
      <div>
        Innerhalb von [{{consistencyMatrix.iterations}}] Iterationen wurden [{{bundleMatrix.bundles.length}}] Bündel erstellt.
      </div>
    </ng-container>

    <div style="height: 50px"></div>

    <h5>
      Download der konsistentesten Bündel
    </h5>
    Der Download der konsistenten Bündel hängt ab von 1. Der Anzahl der gespeicherten Bündel und 2. der Optionskombinationen pro Bündel ab.
    Beispiel: 10 Variablen je 5 Optionen, wobei 4.000 Bündel gespeichert wurden: 4000 Bündel  * 45 Optionskombinationen = 180.000 Speichereinheiten.
    Der Download erfolgt im Excel-Format. 180.000 Speichereinheiten entspricht einer Downloadgröße von ca. 200 MB. 200 MB benötigen ca. 20 Sekunden zum Schreiben der Datei.
    <div style="height: 25px"></div>
    <button mat-raised-button color="" (click)="downloadBundles($event)">Download konsistente Strategiebündel</button>

    <div style="height: 100px"></div>

    <h5>
      Clusteranalyse
    </h5>
    <div>
      Für die Clusteranalyse gibt es einige Parameter. Bitten legen Sie diese nachfolgend fest.
    </div>
    <div>
      Bitte geben Sie das Clusterverfahren an, mit dem die Clusteranalyse erfolgen soll.
      <br>
      <mat-form-field appearance="fill">
        <mat-label>Clusterverfahren</mat-label>
        <mat-select [(ngModel)]="selectedClusterAlgorithm">
          <mat-option *ngFor="let clusterAlgorithm of clusterAlgorithms" [value]="clusterAlgorithm.value">
            {{clusterAlgorithm.viewValue}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div>
      Für die Clusteranalyse geben Sie bitte die zu betrachtete minimale Clusteranzahl und maximale Clusteranzahl an.
      <br>
      Empfohlen ist eine Clusteranalyse im Bereich 1-10.
      <br>
      <div style="height: 20px"></div>

      Minimale Grenze: [1]
      <div style="height: 20px"></div>

      <div style="height: 10px"></div>
      <mat-form-field class="example-full-width" appearance="fill">
      <mat-label>Minimale Clusterzahl</mat-label>
      <input matInput type="number" value="{{minConsideredClusters}}" (input)="setMinConsideredClusters($event)"  />
      </mat-form-field>
      <div style="height: 20px"></div>

      Maximale Grenze: [{{this.bundleMatrix?.bundles?.length}}]
      <div style="height: 20px"></div>

      <mat-form-field class="example-full-width" appearance="fill">
        <mat-label>Maximale Clusterzahl</mat-label>
      <input matInput type="number" value="{{maxConsideredClusters}}" (input)="setMaxConsideredClusters($event)"  />
      </mat-form-field>
      <div style="height: 20px"></div>
    </div>




    <button mat-raised-button color="" (click)="startClusteranalysis($event)">Starte Clusteranalyse (Ellenbogen-Methode)</button>

    <div style="height: 50px"></div>

    <ng-container *ngIf="clusterAnalysisRunning">
      <div>
        Berechnungen der Clusteranalyse laufen...
      </div>
    </ng-container>

    <ng-container *ngIf="!dictIsEmpty(clusterAnalysisResults)">
      <div>
        <app-basic-line-chart [data]="getScatterPlotInput(clusterAnalysisResults)"></app-basic-line-chart>
      </div>

      <div style="height: 50px"></div>
      Bitte entnehmen Sie der Ellenbogenkurve eine angemessene Clusteranzahl und geben Sie diese für folgende Berechnungen an.
      <br>
      Die Anzahl muss zwischen [{{minConsideredClusters}}] und [{{getMaxClusterNumber()}}] liegen.
      <br>
      <div style="height: 10px"></div>
      <mat-form-field class="example-full-width" appearance="fill">
        <mat-label>Anzahl der Cluster</mat-label>
      <input matInput type="number" min="{{minConsideredClusters}}" max="{{maxConsideredClusters}}" (keypress)="setSelectedNumberOfClusters($event)" value="{{selectedNumberOfClusters}}" (input)="setSelectedNumberOfClusters($event)"  />
      </mat-form-field>
      <div style="height: 25px"></div>
      Aktuell wurde intern die Clusteranalyse für [{{selectedNumberOfClusters}}] Cluster registriert. Somit wird mit den Ergebnissen dieser Analyse nachfolgend weiter gearbeitet.
    </ng-container>

    <div style="height: 100px"></div>
    Alternativ können Sie die Clusteranalyse in einem externen Werkzeug erstellen und die Ergebnisse hier hochladen.
    <div style="height: 25px"></div>
    <button mat-raised-button color="" (click)="clusterMembershipMatrixInput.click()">ClusterMembership-Matrix hochladen</button>
    <input hidden type="file" (change)="uploadClusterMembershipMatrix($event)" #clusterMembershipMatrixInput id="uploadClusterMembershipMatrix">

    <div style="height: 25px"></div>

    <ng-container *ngIf="clusterMembershipMatrix">
      <div>
        Ihre ClusterMembershipMatrix wurde erfolgreich hochgeladen.
      </div>
    </ng-container>

    <div style="height: 25px"></div>

    <button mat-raised-button color="" (click)="createBundleUsageMatrix($event)">Erstelle Ausprägungsmatrix</button>

    <div style="height: 25px"></div>

    <ng-container *ngIf="bundleUsageMatrix">
      <div>
        Die Ausprägungsmatrix wurde erstellt.
      </div>
    </ng-container>

    <div style="height: 25px"></div>

    <button mat-raised-button color="" (click)="downloadBundleUsageMatrix($event)">Ausprägungsmatrix herunterladen</button>

    <div style="height: 25px"></div>
  </div>
</div>


</mat-drawer-container>
</div>
